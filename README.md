# Falcon-Synthetic-to-real-Multi-instance-object-detection
# 🥫 6th Place Solution: Soup Can Multi-instance Object Detection (0.989 mAP)

## 🧠 Approach Overview

This solution uses **YOLOv11** to detect and locate Soup Cans in images. By carefully adjusting the training process and enriching the dataset with synthetic images generated by **Falcon**, we achieved a **0.989 mAP** score in the Multi-instance Object Detection Challenge.

---

## 📁 1. Data Strategy

- **Dataset Structure**:
  - Used the full dataset (training + validation) provided by the competition.
  - Added 5 synthetic data folders: `new_data`, `new_data2`, `new_data3`, `new_data4`, `new_data5`.
  - Each folder contains 100 images (81 train, 19 val).
  - Manually excluded images that do **not contain Soup Cans** or have **unclear bounding boxes**.

- **Dataset Summary**:
  - **Total Images**: 544
  - **Training**: 466 images
  - **Validation**: 78 images

- **Test Set**:

  - Used the **test data provided** in the competition.

- **Dataset Set Link**: [Dataset](https://www.kaggle.com/datasets/younesbenalia/multi-instance-object-detection-challenge)

- **Class Handling**:
  - **Single-class detection** (Soup Cans).
  - YOLO-style annotations.

- **Augmentations**:
  - **Mosaic** (disabled in the last 20 epochs).
  - **HSV color space manipulations**:
    - Hue ±0.015
    - Saturation ±0.7
    - Value ±0.4
  - **Spatial transforms**:
    - Flip (50%)
    - Translation (10%)
    - Scaling (50%)
  - **Image resizing** to `1056 × 1056`.

---

## 🏗️ 2. Model Architecture

- **Model**: `YOLOv11x`

- **Optimization**:
  - Optimizer: **SGD** with momentum (0.937)
  - Scheduler: **Cosine Learning Rate Scheduler**
    - Initial learning rate: `0.001`
  - **Weight Decay**: `0.0005` for regularization
  - **Training Duration**: 300 epochs (without early stopping)
  - **Warmup Settings**:
    - `warmup_epochs = 3`
    - `warmup_momentum = 1`

- **Metric Target**:
  - Optimized for **mAP@0.5 IoU**

---

## 🔎 3. Inference Enhancements

- **Model Selection**:
  - Used the checkpoint that performed best on the validation set: `best.pt`

- **Test-Time Augmentation (TTA)**:
  - Flipping and minor zooming during inference to improve predictions.

- **Detection Parameters**:
  - **IoU Threshold**: `0.4`
  - **Max Detections**: `600` per image
  - **Confidence Threshold**: `0` (favoring high recall)

- **Multiscale Inference**:
  - Images were evaluated at 5 different scales:
    - `640`, `1056`, `1440`, `1920`, `2560`
  - Predictions were captured separately for each size.

- **Post-Processing**:
  - **Invalid box filtering**
  - **Weighted Box Fusion (WBF)**:
    - IoU threshold: `0.5`
    - Skip box threshold: `0.01`

---

## 📤 4. Submission

- **Prediction Validation**:
  - Strict format checking to comply with submission requirements.
  - Automatic handling for images with **no detections**.

- **Submission Format**:
  - Final predictions are converted into the required format.
  - **Output File**: `submission_wbf_0.5.csv`

---

## ♻️ Reproducibility

- Fixed random seeds across the entire training pipeline.
- **Hardware** used: `NVIDIA Tesla T4 GPU`.

---

## 📝 Additional Notes

- Synthetic data proved critical for improving generalization due to limited original training images.
- Using a **zero confidence threshold** paired with **WBF** allowed for aggressive box fusion, significantly boosting mAP.
- The pipeline was designed to be **robust to overfitting** through heavy augmentations and proper validation splits.

---

## 📇 Contact Information

If you'd like to connect, collaborate, or ask questions, feel free to reach out:

- **👨‍💻 Author**: Younes Benalia  
- **📧 Email**: [younes.benalia.dz@gmail.com]  
- **🔗 LinkedIn**: [younesbenalia](https://www.linkedin.com/in/younesbenalia)  
- **📊 Kaggle**: [younesbenalia](https://www.kaggle.com/younesbenalia)  
- **🐙 GitHub**: [younesBenalia](https://github.com/younesBenalia)
- **🐙 Huggingface**: [younesbenalia](https://huggingface.co/younesbenalia)  
- **📊 Kaggle notebook**: [notebook](https://www.kaggle.com/code/younesbenalia/soup-can-detection-6th-place-solution)  
---

